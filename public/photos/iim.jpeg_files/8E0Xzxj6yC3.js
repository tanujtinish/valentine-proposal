;/*FB_PKG_DELIM*/

__d("ExternalShareOptionImpressionFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("3043"),s=o("FalcoLoggerInternal").create("external_share_option_impression",e),u=s;l.default=u}),98);
__d("ExternalShareOptionTappedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5134"),s=o("FalcoLoggerInternal").create("external_share_option_tapped",e),u=s;l.default=u}),98);
__d("PolarisBaseGraphQLEventHandler",[],(function(t,n,r,o,a,i){"use strict";var e="1/graphqlsubscriptions/",l=Object.freeze({BD_CHALLENGE:"BdChallenge",NONE:"",PINNED_QUESTION:"PinnedQuestion",QUESTION_STATUS:"QuestionStatus",WAVE:"Wave"}),s=(function(){function t(){}var n=t.prototype;return n.processEventMessage=function(t){},n.getSubTopic=function(){return null},n.getGraphQLSubsciptionPrefix=function(){return e},n.getType=function(){return l.NONE},t})();i.GRAPH_QL_EVENT_TYPES=l,i.BaseGraphQLEventHandler=s}),66);
__d("PolarisBdChallengeGraphQLEventHandler",["PolarisBaseGraphQLEventHandler","PolarisDirectLogger","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e="17935802131473058",s=(function(t){function n(n){var a;return a=t.call(this)||this,a.$BdChallengeGraphQLEventHandler$p_1=new(o("PolarisDirectLogger")).DirectLogger("BDChallengeGraphQLEventHandler",n),a.$BdChallengeGraphQLEventHandler$p_1.debugTrace("bd_challenge_gql_handler_init"),a.$BdChallengeGraphQLEventHandler$p_2=a.getGraphQLSubsciptionPrefix()+e+"/"+JSON.stringify({input_data:{client_subscription_id:r("uuidv4")()}}),a}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.processEventMessage=function(t){var e=t.bd_challenge_event;if(e==null){this.$BdChallengeGraphQLEventHandler$p_1.debugTrace("parsed_message_bad_data");return}},a.getSubTopic=function(){return this.$BdChallengeGraphQLEventHandler$p_2},a.getType=function(){return o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.BD_CHALLENGE},n})(o("PolarisBaseGraphQLEventHandler").BaseGraphQLEventHandler);l.BdChallengeGraphQLEventHandler=s}),98);
__d("PolarisChannelClientID",["uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e=r("uuidv4")(),s={getID:function(){return e}},u=s;l.default=u}),98);
__d("PolarisDirectBaseSubscription",["getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(e,t,n,o){var a=this;this.$5=function(e){a.$4.debugTrace("message_received");var t=a.parsePayload(e);if(t!=null){var n;if(e.length===0){a.$4.logError("empty_message");return}else e[e.length-1]==="\0"?(n=e.substring(0,e.length-1),a.$4.debugTrace("trimmed_null_char")):n=e;var o={};try{o=JSON.parse(n)}catch(t){var i=r("getErrorSafe")(t),l={};i.message.includes("Unexpected token")&&(l.jsonFirstChars=typeof n=="string"?n.substr(0,3):null),a.$4.logError("Cannot parse message "+e,i,l);return}a.processMessage(o)}},this.$1=e,this.$2=t,this.$3=n,this.$4=o,this.$4.debugTrace("ctor")}var t=e.prototype;return t.parsePayload=function(t){return t},t.processMessage=function(t){},t.$6=function(t){var e;return JSON.stringify((e={},e[t]=this.getSubTopics(),e))},t.subscribe=function(){var e=this;if(this.getSubTopics().length<1){this.$4.debugTrace("no_subtopics_to_subscribe");return}this.$4.debugTrace("subscribe_start"),this.unsubscribe(),this.$3.subscribe(this.$1,this.$5),this.$3.publish(this.$1,this.$6("sub")).catch(function(t){var n=r("getErrorSafe")(t);e.$4.logError(n.message,n)}),this.$4.debugTrace("subscribe_end")},t.unsubscribe=function(){var e=this;if(this.getSubTopics().length<1){this.$4.debugTrace("no_subtopics_to_unsubscribe");return}this.$4.debugTrace("unsubscribe_start"),this.$3.publish(this.$1,this.$6("unsub")).catch(function(t){var n=r("getErrorSafe")(t);e.$4.logError(n.message,n)}),this.$3.unsubscribe(this.$1),this.$4.debugTrace("unsubscribe_end")},t.updateSubTopics=function(t){this.$2=t},t.getSubTopics=function(){return this.$2},e})();l.DirectBaseSubscription=e}),98);
__d("PolarisPinnedQuestionGraphQLEventHandler",["PolarisBaseGraphQLEventHandler","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e="PINNED_QUESTION",s="18005526940184517",u=(function(t){function n(e,n){var o;return o=t.call(this)||this,o.$PinnedQuestionGraphQLEventHandler$p_1=e,o.$PinnedQuestionGraphQLEventHandler$p_2=o.getGraphQLSubsciptionPrefix()+s+"/"+JSON.stringify({input_data:{broadcast_id:String(n.id),client_subscription_id:r("uuidv4")()}}),o}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.processEventMessage=function(n){var t=n.live_active_question_event;if(t!=null){var r={question:t,type:e};this.$PinnedQuestionGraphQLEventHandler$p_1.eventHandler(r)}},a.getSubTopic=function(){return this.$PinnedQuestionGraphQLEventHandler$p_2},a.getType=function(){return o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION},n})(o("PolarisBaseGraphQLEventHandler").BaseGraphQLEventHandler);l.PinnedQuestionGraphQLEventHandler=u}),98);
__d("PolarisQuestionStatusGraphQLEventHandler",["PolarisBaseGraphQLEventHandler","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e="QUESTION_STATUS",s="18027779584026952",u=(function(t){function n(e,n){var o;return o=t.call(this)||this,o.$QuestionStatusGraphQLEventHandler$p_1=e,o.$QuestionStatusGraphQLEventHandler$p_2=o.getGraphQLSubsciptionPrefix()+s+"/"+JSON.stringify({input_data:{broadcast_id:String(n.id),client_subscription_id:r("uuidv4")()}}),o}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.processEventMessage=function(n){var t=n.live_question_submission_status_event;if(t!=null){var r={status:t,type:e};this.$QuestionStatusGraphQLEventHandler$p_1.eventHandler(r)}},a.getSubTopic=function(){return this.$QuestionStatusGraphQLEventHandler$p_2},a.getType=function(){return o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.QUESTION_STATUS},n})(o("PolarisBaseGraphQLEventHandler").BaseGraphQLEventHandler);l.QuestionStatusGraphQLEventHandler=u}),98);
__d("PolarisWaveGraphQLEventHandler",["PolarisBaseGraphQLEventHandler","PolarisConfig","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e="LIVE_WAVE",s="17882305414154951",u=(function(t){function n(e,n){var a;return a=t.call(this)||this,a.$WaveGraphQLEventHandler$p_1=e,a.$WaveGraphQLEventHandler$p_2=a.getGraphQLSubsciptionPrefix()+s+"/"+JSON.stringify({input_data:{broadcast_id:String(n.id),client_subscription_id:r("uuidv4")(),receiver_id:o("PolarisConfig").getViewerId()},publish_data:{broadcast_id:String(n.id),receiver_id:o("PolarisConfig").getViewerId(),waver_id:String(n.broadcast_owner)}}),a}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.processEventMessage=function(n){var t=n.live_video_wave_event;if(t!=null){var r={type:e,wave:t};this.$WaveGraphQLEventHandler$p_1.eventHandler(r)}},a.getSubTopic=function(){return this.$WaveGraphQLEventHandler$p_2},a.getType=function(){return o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE},n})(o("PolarisBaseGraphQLEventHandler").BaseGraphQLEventHandler);l.WaveGraphQLEventHandler=u}),98);
__d("PolarisDirectGraphQLSubscription",["PolarisBaseGraphQLEventHandler","PolarisBdChallengeGraphQLEventHandler","PolarisDirectBaseSubscription","PolarisDirectLogger","PolarisPinnedQuestionGraphQLEventHandler","PolarisQuestionStatusGraphQLEventHandler","PolarisWaveGraphQLEventHandler","isStringNullOrEmpty"],(function(t,n,r,o,a,i,l){"use strict";var e="/ig_realtime_sub",s=(function(t){function n(n,r,a){var i,l=new(o("PolarisDirectLogger")).DirectLogger("DirectGraphQLSubscription",a);return i=t.call(this,e,[],r,l)||this,i.$DirectGraphQLSubscription$p_2=l,i.$DirectGraphQLSubscription$p_1=n,i.$DirectGraphQLSubscription$p_3=new Map,i.$DirectGraphQLSubscription$p_4(),i.getSubTopics(),i}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.$DirectGraphQLSubscription$p_4=function(){for(var e of Object.keys(o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES))o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES[e]!==o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE&&o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES[e]!==o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION&&!this.$DirectGraphQLSubscription$p_5(o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES[e])&&this.$DirectGraphQLSubscription$p_2.debugTrace("invalid_handler_type")},a.getSubTopics=function(){var e=[];for(var t of this.$DirectGraphQLSubscription$p_3){var n=t[0],o=t[1],a=o.getSubTopic();r("isStringNullOrEmpty")(a)||e.push(a)}return this.updateSubTopics(e),e},a.processMessage=function(n){for(var e of this.$DirectGraphQLSubscription$p_3){var r=e[0],o=e[1];o.processEventMessage(n)}t.prototype.processMessage.call(this,n)},a.enableOrDisableEventHandlerByType=function(t,n){return n?this.$DirectGraphQLSubscription$p_5(t)||this.$DirectGraphQLSubscription$p_2.debugTrace("invalid_handler_type"):this.$DirectGraphQLSubscription$p_3.delete(t),this},a.$DirectGraphQLSubscription$p_5=function(t){this.$DirectGraphQLSubscription$p_3||(this.$DirectGraphQLSubscription$p_3=new Map);var e=this.$DirectGraphQLSubscription$p_6(t);return e!=null?(this.$DirectGraphQLSubscription$p_3.set(t,e),!0):!1},a.$DirectGraphQLSubscription$p_6=function(t){switch(t){case o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.BD_CHALLENGE:return new(o("PolarisBdChallengeGraphQLEventHandler")).BdChallengeGraphQLEventHandler(this.$DirectGraphQLSubscription$p_2.getDebugId());default:return null}},a.enableLiveEventHandler=function(t,n,r){switch(r){case o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE:return this.$DirectGraphQLSubscription$p_3.set(o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE,new(o("PolarisWaveGraphQLEventHandler")).WaveGraphQLEventHandler(n,t)),this;case o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION:return this.$DirectGraphQLSubscription$p_3.set(o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION,new(o("PolarisPinnedQuestionGraphQLEventHandler")).PinnedQuestionGraphQLEventHandler(n,t)),this;case o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.QUESTION_STATUS:return this.$DirectGraphQLSubscription$p_3.set(o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.QUESTION_STATUS,new(o("PolarisQuestionStatusGraphQLEventHandler")).QuestionStatusGraphQLEventHandler(n,t)),this;default:return this}},a.disableLiveEventHandler=function(t){switch(t){case o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE:return this.$DirectGraphQLSubscription$p_3.delete(o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE),this;case o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION:return this.$DirectGraphQLSubscription$p_3.delete(o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.PINNED_QUESTION),this;case o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.QUESTION_STATUS:return this.$DirectGraphQLSubscription$p_3.delete(o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.QUESTION_STATUS),this;default:return this}},a.unsubscribeGraphQL=function(){this.unsubscribe(),this.enableOrDisableEventHandlerByType(o("PolarisBaseGraphQLEventHandler").GRAPH_QL_EVENT_TYPES.WAVE,!1)},n})(o("PolarisDirectBaseSubscription").DirectBaseSubscription);l.DirectGraphQLSubscription=s}),98);
__d("PolarisDirectIrisSubscription",["FBLogger","PolarisDirectLogger","getErrorSafe","isObject"],(function(t,n,r,o,a,i,l){"use strict";var e=1,s=2,u=1e3,c=64e3,d=(function(){function t(t,n,a,i){var l=this;this.$7=function(){l.$6.logDirectClientEvent("ig_direct_iris_subscription",o("PolarisDirectLogger").DIRECT_CONTAINER_MODULES.ig_direct_realtime,babelHelpers.extends({},l.$2,{action:"attempt",attempt_reason:"mqtt-connected"})),l.$1.onIrisConnectivityChanged("Subscribing");var e=JSON.stringify(l.$2);l.$3.publish("/ig_sub_iris",e).catch(function(e){l.$6.logDirectClientEvent("ig_direct_iris_subscription",o("PolarisDirectLogger").DIRECT_CONTAINER_MODULES.ig_direct_realtime,babelHelpers.extends({},l.$2,{action:"error",error:JSON.stringify(e)})),l.$1.onIrisConnectivityChanged("Unsubscribed")})},this.$8=function(t){var n;if(typeof t=="string"||t instanceof String)try{n=JSON.parse(t)}catch(e){var a=r("getErrorSafe")(e),i="Could not parse sub iris response $(response)";l.$6.logError(i,a),r("FBLogger")("ig_web").mustfix(i),n={succeeded:!1}}else r("isObject")(t)?n=t:(r("FBLogger")("ig_web").mustfix("Unknown sub iris response $(response)"),n={succeeded:!1});if(n.succeeded===!0)l.$6.logDirectClientEvent("ig_direct_iris_subscription",o("PolarisDirectLogger").DIRECT_CONTAINER_MODULES.ig_direct_realtime,babelHelpers.extends({},l.$2,{action:"success"})),l.$1.onIrisConnectivityChanged("Subscribed",l.$2.subscription_type);else if(l.$6.logDirectClientEvent("ig_direct_iris_subscription",o("PolarisDirectLogger").DIRECT_CONTAINER_MODULES.ig_direct_realtime,babelHelpers.extends({},l.$2,n,{action:"error"})),l.$1.onIrisConnectivityChanged("Unsubscribed"),n.error_type===e)l.$1.onResnapshotRequested(l.$2);else if(n.error_type===s){var u=l.$4+Math.floor(Math.random()*1e3);window.setTimeout(l.$7,u),l.$4=Math.min(l.$4*2,c)}},this.$6=new(o("PolarisDirectLogger")).DirectLogger("DirectIrisSubscription",i),this.$6.debugTrace("ctor",n),this.$1=t,this.$2=n,this.$3=a,this.$4=u}var n=t.prototype;return n.subscribe=function(){this.$6.debugTrace("subscribe_start"),this.unsubscribe(),this.$3.subscribe("/ig_sub_iris_response",this.$8),this.$7(),this.$6.debugTrace("subscribe_end")},n.unsubscribe=function(){this.$6.debugTrace("unsubscribe_start"),this.$5&&(window.clearTimeout(this.$5),this.$5=null),this.$3.unsubscribe("/ig_sub_iris_response"),this.$1.onIrisConnectivityChanged("Unsubscribed"),this.$6.debugTrace("unsubscribe_end")},t})();l.DirectIrisSubscription=d}),98);
__d("PolarisDirectSkywalkerSubscription",["PolarisConfig","PolarisDirectBaseSubscription","PolarisDirectLogger","nullthrows"],(function(t,n,r,o,a,i,l){"use strict";var e="/pubsub",s=(function(t){function n(n,a,i){var l,s=new(o("PolarisDirectLogger")).DirectLogger("DirectSkywalkerSubscription",i);return l=t.call(this,e,["ig/u/v1/"+r("nullthrows")(o("PolarisConfig").getViewerId())],a,s)||this,l.$DirectSkywalkerSubscription$p_2=s,l.$DirectSkywalkerSubscription$p_1=n,l}babelHelpers.inheritsLoose(n,t);var a=n.prototype;return a.parsePayload=function(n){return n.indexOf("/activity_indicator_id/")===-1?(this.$DirectSkywalkerSubscription$p_2.debugTrace("not_activity_indicator_message"),null):t.prototype.parsePayload.call(this,n)},a.processMessage=function(n){var e=n.data,r=n.event;if(r!=="patch"){this.$DirectSkywalkerSubscription$p_2.debugTrace("skipped_message",{event:r});return}if(!Array.isArray(e)){this.$DirectSkywalkerSubscription$p_2.debugTrace("parsed_message_bad_data",typeof e);return}for(var o of e)this.$DirectSkywalkerSubscription$p_1.handleDelta(o,"");t.prototype.processMessage.call(this,n)},n})(o("PolarisDirectBaseSubscription").DirectBaseSubscription);l.DirectSkywalkerSubscription=s}),98);
__d("PolarisLiveDeltaHandler",[],(function(t,n,r,o,a,i){"use strict";var e=function(t){this.eventHandler=t};i.default=e}),66);
__d("PolarisMqttEnv",[],(function(t,n,r,o,a,i){"use strict";var e=Object.freeze({messenger_uses_mqtt_rollout:2,mqtt_ep_with_sid:0,mqtt_fast_lp:11,mqtt_lp_use_fetch:9,mqtt_waterfall_log_client_sampling:1,mqtt_ws_forced_polling_only:4,mqtt_ws_polling_enabled:3,mqtt_ws_reconnect_reset:7}),l=(function(){function e(){this.$1=null,this.$2=null,this.$3=null,this.$4=null,this.$5=null,this.$6=null,this.$7=null,this.$8=null,this.$9=null,this.$10=null,this.$11=null}var t=e.prototype;return t.random=function(){return this.$1!=null?this.$1():Math.random()},t.isUserLoggedInNow=function(){return this.$2!=null?this.$2():!0},t.clearTimeout=function(t){if(this.$3!=null){this.$3(t);return}window.clearTimeout(t)},t.setTimeout=function(t,n){for(var e=arguments.length,r=new Array(e>2?e-2:0),o=2;o<e;o++)r[o-2]=arguments[o];return this.$4!=null?this.$4.apply(null,arguments):window.setTimeout.apply(null,arguments)},t.getLoggerInstance=function(){return this.$5!=null?this.$5():s.getInstance()},t.genGk=function(t){return this.$6!=null?this.$6(t):!1},t.createSocket=function(t,n){return this.$7!=null?this.$7(t,n):new WebSocket(t)},t.scheduleCallback=function(t){return this.$8!=null?this.$8(t):t()},t.scheduleLoggingCallback=function(t){return this.$9!=null?this.$9(t):t()},t.configRead=function(t,n){return this.$10!=null?this.$10(t,n):n},t.configWrite=function(t,n){this.$11!=null&&this.$11(t,n)},t.initialize=function(t,n,r,o,a,i,l,s,u,c,d){this.$1=t,this.$2=n,this.$3=r,this.$4=o,this.$5=a,this.$6=i,this.$7=l,this.$8=s,this.$9=u,this.$10=c,this.$11=d},e})(),s=(function(){function e(){}e.getInstance=function(){return new e};var t=e.prototype;return t.setAppId=function(t){},t.eventLogConnect=function(t){var e=t.attemptNumber,n=t.connectionStatus,r=t.duration,o=t.errorCode,a=t.errorMessage,i=t.failTotal,l=t.hostname,s=t.publishes,u=t.sessionID,c=t.subscribedTopics,d=t.successTotal},t.eventLogPull=function(t){var e=t.duration,n=t.errorMessage,r=t.hostname,o=t.pullEventName,a=t.sessionID,i=t.status},t.eventLogDisconnect=function(t){var e=t.duration,n=t.errorCode,r=t.errorMessage,o=t.sessionID},t.eventLogPublish=function(t){var e=t.connectionStatus,n=t.publishStatus,r=t.sessionID,o=t.topic},t.eventLogMiscellaneousError=function(t){var e=t.errorMessage},t.logError=function(t,n){},t.logErrorWarn=function(t,n){},t.logWarn=function(t,n){},t.debugTrace=function(t,n){},t.bumpCounter=function(t){},e})(),u={Env:new l,MqttGkNames:e};i.default=u}),66);
__d("PolarisIrisSubscribeChecker",["PolarisMqttEnv"],(function(t,n,r,o,a,i){"use strict";var e=n("PolarisMqttEnv").Env,l=n("PolarisMqttEnv").MqttGkNames,s=(function(){function t(t){if(this.$1=e.getLoggerInstance(),this.$2=null,this.$3=!1,this.$4=!1,this.$5=!1,this.$6=!0,this.$7=0,this.$8=t,typeof window!="undefined"){var n=window.location.hostname;(n==="m.facebook.com"||n==="mobile.facebook.com"||n==="mtouch.facebook.com")&&(this.$6=!1)}e.genGk(l.messenger_uses_mqtt_rollout)||(this.$6=!1)}var n=t.prototype;return n.start=function(){this.$6=!0},n.stop=function(){this.$6=!1,this.$9()},n.onConnectAttempt=function(){},n.onConnectFailure=function(){this.$9()},n.onConnected=function(){var t=this;this.$7++,this.$9(),this.$3=!1,this.$4=!1,this.$5=!1,this.$6&&(this.$2=e.setTimeout(function(){t.$10()},8e3))},n.onConnectSuccess=function(){},n.onConnectionLost=function(){this.$9()},n.onSubscribe=function(t){t==="/t_ms"&&(this.$3=!0)},n.onUnsubscribe=function(t){},n.onPublish=function(t){(t==="/messenger_sync_get_diffs"||t==="/messenger_sync_create_queue")&&(this.$4=!0,this.$3&&(this.$5=!0,this.$9()))},n.onMessage=function(t){},n.onWSFatal=function(){},n.$9=function(){this.$2&&(e.clearTimeout(this.$2),this.$2=null)},n.$10=function(){if(this.$4===!1){var e=this.$7===1?"no_iris_session_initialConnect":"no_iris_session";this.$1.bumpCounter(e),this.$1.eventLogMiscellaneousError({errorMessage:e}),this.$8()?this.$1.bumpCounter(e+".withProvider"):this.$1.bumpCounter(e+".withoutProvider"),this.$3===!0?this.$1.bumpCounter(e+".withTopicSubscribe"):this.$1.bumpCounter(e+".withoutTopicSubscribe")}this.$3===!1&&this.$1.bumpCounter("no_iris_topic_subscribe"),this.$3===!0&&this.$4===!0&&this.$5===!1&&this.$1.bumpCounter("session_before_topic_subscribe")},t})();a.exports=s}),null);
__d("PolarisMqttAnalyticsHook",["InstagramODS","PolarisMqttEnv"],(function(t,n,r,o,a,i,l){"use strict";var e=(function(){function e(){this.$1=r("PolarisMqttEnv").Env.getLoggerInstance(),this.$2=0,this.$3=0,this.$4=0,this.$5=0,r("InstagramODS").incr("web.mqtt.session_start"),r("PolarisMqttEnv").Env.isUserLoggedInNow()||r("InstagramODS").incr("web.mqtt.session_start.logout")}var t=e.prototype;return t.onConnectAttempt=function(){r("InstagramODS").incr("web.mqtt.ws_connect_attempt")},t.onConnectFailure=function(){this.$3++,r("InstagramODS").incr("web.mqtt.ws_connect_failure")},t.onConnected=function(){r("InstagramODS").incr("web.mqtt.ws_connect_connected")},t.onConnectSuccess=function(){this.$2===0&&r("InstagramODS").incr("web.mqtt.ws_connect_first_success"),this.$2++,r("InstagramODS").incr("web.mqtt.ws_connect_success")},t.onConnectionLost=function(){r("InstagramODS").incr("web.mqtt.ws_disconnect")},t.onSubscribe=function(t){},t.onUnsubscribe=function(t){},t.onPublish=function(t){r("InstagramODS").incr("web.mqtt.ws_publish")},t.onMessage=function(t){r("InstagramODS").incr("web.mqtt.message_arrived")},t.onWSFatal=function(){r("InstagramODS").incr("web.mqtt.ws_fatal")},t.onPollRequestSent=function(){r("InstagramODS").incr("web.mqtt.polling_request_send")},t.onPollRequestSuccess=function(){r("InstagramODS").incr("web.mqtt.polling_request_succeed"),this.$4===0&&r("InstagramODS").incr("web.mqtt.polling_first_success"),this.$4++},t.onPollResponse=function(){r("InstagramODS").incr("web.mqtt.lp.message_arrived")},t.onPollFinish=function(){},t.onPollRequestFailed=function(){r("InstagramODS").incr("web.mqtt.polling_request_failed"),this.$5++},e})();l.default=e}),98);
__d("PolarisMqttConnectionHookCollection",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(){this.$1=new Set}var t=e.prototype;return t.addHook=function(t){this.$1.add(t)},t.removeHook=function(t){this.$1.delete(t)},t.onConnectAttempt=function(){this.$1.forEach(function(e){e.onConnectAttempt()})},t.onConnectFailure=function(){this.$1.forEach(function(e){e.onConnectFailure()})},t.onConnected=function(){this.$1.forEach(function(e){e.onConnected()})},t.onConnectSuccess=function(){this.$1.forEach(function(e){e.onConnectSuccess()})},t.onConnectionLost=function(){this.$1.forEach(function(e){e.onConnectionLost()})},t.onSubscribe=function(t){this.$1.forEach(function(e){e.onSubscribe(t)})},t.onUnsubscribe=function(t){this.$1.forEach(function(e){e.onUnsubscribe(t)})},t.onPublish=function(t){this.$1.forEach(function(e){e.onPublish(t)})},t.onMessage=function(t){this.$1.forEach(function(e){e.onMessage(t)})},t.onWSFatal=function(){this.$1.forEach(function(e){e.onWSFatal()})},e})();i.default=e}),66);
__d("PolarisMqttProtocolUtils",["PolarisMqttEnv"],(function(t,n,r,o,a,i){"use strict";var e=n("PolarisMqttEnv").Env;function l(e,t){if(e==null)return t;var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function s(e,t){var n=t,r=0,o=1,a;do{if(n===e.length)return null;a=e[n++],r+=(a&127)*o,o*=128}while((a&128)!==0);return{offset:n,value:r}}function u(e){for(var t=e,n=new Array(1),r=0;r<4;r++){var o=t%128;if(t>>=7,t>0)n[r]=o|128;else{n[r]=o;break}}return n}function c(e,t,n){var r=n;return t[r++]=e>>8,t[r++]=e%256,r}function d(e,t){return 256*e[t]+e[t+1]}function m(e){for(var t=0,n=0,r=e.length;n<r;n++){var o=e.charCodeAt(n);o<128?t+=1:o<2048?t+=2:o>=55296&&o<=56319?(t+=4,n++):t+=3}return t}function p(e,t,n,r){var o=c(t,n,r);return _(e,n,o),o+t}function _(e,t,n){for(var r=n,o=0,a=e.length;o<a;o++){var i=e.charCodeAt(o);i<128?t[r++]=i:i<2048?(t[r++]=192|i>>6,t[r++]=128|i&63):i<55296||i>=57344?(t[r++]=224|i>>12,t[r++]=128|i>>6&63,t[r++]=128|i&63):(i=65536+((i&1023)<<10|e.charCodeAt(++o)&1023),t[r++]=240|i>>18,t[r++]=128|i>>12&63,t[r++]=128|i>>6&63,t[r++]=128|i&63)}}function f(e,t,n){for(var r=[],o=t,a=0;o<t+n;){var i=e[o++];if(i<128)r[a++]=String.fromCharCode(i);else if(i>191&&i<224){var l=e[o++];r[a++]=String.fromCharCode((i&31)<<6|l&63)}else if(i>239&&i<365){var s=e[o++],u=e[o++],c=e[o++],d=((i&7)<<18|(s&63)<<12|(u&63)<<6|c&63)-65536;r[a++]=String.fromCharCode(55296+(d>>10)),r[a++]=String.fromCharCode(56320+(d&1023))}else{var m=e[o++],p=e[o++];r[a++]=String.fromCharCode((i&15)<<12|(m&63)<<6|p&63)}}return r.join("")}var g=(function(){function t(e,t,n){this.$1=e*1e3,this.$4=t,this.$5=n,this.$3=!1}var n=t.prototype;return n.$6=function(){var t=this;this.$3?(this.$3=!1,this.$4(),this.$2=e.setTimeout(function(){t.$6()},this.$1)):this.$5()},n.reset=function(){var t=this;this.$3=!0,this.$2&&(e.clearTimeout(this.$2),this.$2=null),this.$1>0&&(this.$2=e.setTimeout(function(){t.$6()},this.$1))},n.cancel=function(){this.$2&&(e.clearTimeout(this.$2),this.$2=null)},t})();a.exports={Pinger:g,UTF8Length:m,concatBuffers:l,convertStringToUTF8:_,convertUTF8ToString:f,decodeMultiByteInt:s,encodeMultiByteInt:u,readUInt16BE:d,writeString:p,writeUInt16BE:c}}),null);
__d("PolarisMqttUtils",["PolarisMqttEnv","err","promiseDone"],(function(t,n,r,o,a,i,l){"use strict";var e={endpointWithExtraParameter:function(t,n,r){return t.indexOf("?")>0?t+"&"+n+"="+r:t+"?"+n+"="+r},endpointWithExtraParameters:function(n,r){var t=n;return r.forEach(function(n,r){t=e.endpointWithExtraParameter(t,r,n)}),t},endpointWithSessionId:function(n,o){return r("PolarisMqttEnv").Env.genGk(r("PolarisMqttEnv").MqttGkNames.mqtt_ep_with_sid)?e.endpointWithExtraParameter(n,"sid",o.toString()):n},generateSessionId:function(){return Math.floor(r("PolarisMqttEnv").Env.random()*Number.MAX_SAFE_INTEGER)},hasWSSupport:function(){return"WebSocket"in t&&t.WebSocket!==null},promiseDone:function(t,n,o){var e=arguments.length>1?t.then(n,o):t;r("promiseDone")(e.then(null,function(e){r("PolarisMqttEnv").Env.setTimeout(function(){throw e instanceof Error?e:r("err")("promiseDone")},0)}))},sprintf:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=0;return t.replace(/%s/g,function(){return String(n[o++])})}},s=e;l.default=s}),98);
__d("PolarisMqttProtocolCodec",["PolarisMqttProtocolUtils","PolarisMqttUtils"],(function(t,n,r,o,a,i){"use strict";var e,l=(e=n("PolarisMqttProtocolUtils")).UTF8Length,s=e.convertStringToUTF8,u=e.convertUTF8ToString,c=e.decodeMultiByteInt,d=e.encodeMultiByteInt,m=e.readUInt16BE,p=e.writeString,_=e.writeUInt16BE,f=n("PolarisMqttUtils").sprintf,g=Object.freeze({CONNACK:2,CONNECT:1,DISCONNECT:14,PINGREQ:12,PINGRESP:13,PUBACK:4,PUBLISH:3,SUBACK:9,SUBSCRIBE:8,UNSUBACK:11,UNSUBSCRIBE:10}),h=[0,6,77,81,73,115,100,112,3];function y(e,t){var n=t,r=n,o=e[n],a=o>>4;n+=1;var i=c(e,n);if(i==null)return{position:r,wireMessage:null};n=i.offset;var l=n+i.value;if(l>e.length)return{position:r,wireMessage:null};var s;switch(a){case g.CONNACK:{var d=e[n++],p=!!(d&1),_=e[n++];s=new L(p,_);break}case g.PUBLISH:{var h=o&15,y=h>>1&3,C=m(e,n);n+=2;var b=u(e,n,C);n+=C;var S=null;y===1&&(S=m(e,n),n+=2);var k=T.createWithBytes(e.subarray(n,l)),I=(h&1)===1,x=(h&8)===8;s=new D(b,k,y,S,I,x);break}case g.PINGREQ:s=new v("PINGREQ");break;case g.PINGRESP:s=new v("PINGRESP");break;case g.PUBACK:case g.UNSUBACK:{var $=m(e,n);s=new E(a===g.PUBACK?"PUBACK":"UNSUBACK",$);break}case g.SUBACK:{var P=m(e,n);n+=2;var N=e.subarray(n,l);s=new R(P,N);break}default:throw new Error(f("Invalid MQTT message type %s.",a))}return{position:l,wireMessage:s}}function C(e){for(var t=[],n=0;n<e.length;){var r=y(e,n),o=r.wireMessage;if(n=r.position,o)t.push(o);else break}var a=null;return n<e.length&&(a=e.subarray(n)),{messages:t,remaining:a}}var b=(function(){function e(e){this.messageType=g[e]}var t=e.prototype;return t.encode=function(){throw new TypeError("Cannot abstract class WireMessage")},e})(),v=(function(e){function t(t){return e.call(this,t)||this}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.encode=function(){var e=new ArrayBuffer(2),t=new Uint8Array(e);return t[0]=(this.messageType&15)<<4,e},t})(b),S=(function(e){function t(){return e.call(this,"DISCONNECT")||this}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.encode=function(){var e=(this.messageType&15)<<4,t=new ArrayBuffer(2),n=new Uint8Array(t);return n[0]=e,n.set(d(0),1),t},t})(b),R=(function(e){function t(t,n){var r;return r=e.call(this,"SUBACK")||this,r.messageIdentifier=t,r.returnCode=n,r}return babelHelpers.inheritsLoose(t,e),t})(b),L=(function(e){function t(t,n){var r;return r=e.call(this,"CONNACK")||this,r.sessionPresent=t,r.returnCode=n,r}return babelHelpers.inheritsLoose(t,e),t})(b),E=(function(e){function t(t,n){var r;return r=e.call(this,t)||this,r.messageIdentifier=n,r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.encode=function(){var e=(this.messageType&15)<<4,t=2,n=d(t),r=n.length+1,o=new ArrayBuffer(t+r),a=new Uint8Array(o);return a[0]=e,a.set(n,1),r=_(this.messageIdentifier,a,r),o},t})(b),k=(function(e){function t(t,n){var r;return r=e.call(this,"CONNECT")||this,r.clientId=t,r.connectOptions=n,r}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.encode=function(){var e=(this.messageType&15)<<4,t=h.length+3;t+=l(this.clientId)+2,t+=l(this.connectOptions.userName)+2;var n=d(t),r=new ArrayBuffer(1+n.length+t),o=new Uint8Array(r);o[0]=e;var a=1;o.set(n,1),a+=n.length,o.set(h,a),a+=h.length;var i=130;return o[a++]=i,a=_(this.connectOptions.keepAliveInterval,o,a),a=p(this.clientId,l(this.clientId),o,a),a=p(this.connectOptions.userName,l(this.connectOptions.userName),o,a),r},t})(b),I=(function(e){function t(t,n,r,o){var a;if(a=e.call(this,t)||this,a.topic=n,r<0&&r>1||r===1&&o==null)throw new TypeError(f("Argument Invalid. qos: %s messageType: %s.",r,t));return a.qos=r,a.messageIdentifier=o,a}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.encode=function(){var e=(this.messageType&15)<<4;e|=2;var t=l(this.topic),n=2+t+2;this.messageType===g.SUBSCRIBE&&(n+=1);var r=d(n),o=new ArrayBuffer(1+r.length+n),a=new Uint8Array(o);a[0]=e;var i=1;return a.set(r,1),i+=r.length,this.messageIdentifier!=null&&(i=_(this.messageIdentifier,a,i)),i=p(this.topic,t,a,i),this.messageType===g.SUBSCRIBE&&this.qos!=null&&(a[i++]=this.qos),o},t})(b),T=(function(){function e(e,t){this.payloadString=e,this.payloadBytes=t}e.createWithString=function(n){var t=new Uint8Array(new ArrayBuffer(l(n)));return s(n,t,0),new e(n,t)},e.createWithBytes=function(n){for(var t=0,r=n.length;t<n.length&&n[t]!==123&&n[t]!==91;)t++,r--;var o=u(n,t,r),a=n.subarray(t,r);return new e(o,a)};var t=e.prototype;return t.string=function(){return this.payloadString},t.bytes=function(){return this.payloadBytes},e})(),D=(function(e){function t(t,n,r,o,a,i){var l;if(l=e.call(this,"PUBLISH")||this,l.topic=t,l.payloadMessage=n,l.qos=r,l.messageIdentifier=o,l.retained=a!=null?a:!1,l.duplicate=i!=null?i:!1,l.qos===1&&l.messageIdentifier==null)throw new TypeError("Argument Invalid. messageIdentifier: null and qos: 1");return l}babelHelpers.inheritsLoose(t,e);var n=t.prototype;return n.encode=function(){var e=(this.messageType&15)<<4;this.duplicate&&(e|=8),e=e|=this.qos<<1,this.retained&&(e|=1);var t=l(this.topic),n=t+2;n+=this.messageIdentifier==null?0:2;var r=this.payloadMessage.bytes();n+=r.byteLength;var o=d(n),a=new ArrayBuffer(1+o.length+n),i=new Uint8Array(a);i[0]=e,i.set(o,1);var s=1+o.length;return s=p(this.topic,t,i,s),this.messageIdentifier!=null&&(s=_(this.messageIdentifier,i,s)),i.set(r,s),a},t})(b);a.exports={MESSAGE_TYPE:g,WireMessage:{Base:b,ConnAck:L,Connect:k,Disconnect:S,Ping:v,PubAckUnsubAck:E,Publish:D,Subscription:I},createMessageWithString:T.createWithString,decodeByteMessages:C,decodeMessage:y}}),null);
__d("PolarisMqttTypes",[],(function(t,n,r,o,a,i){"use strict";var e=function(t,n){this.errorCode=t,this.errorMessage=n},l=function(t,n){this.mqttError=t,this.connAck=n},s=(function(e){function t(t,n,r){var o;return r===void 0&&(r=null),o=e.call(this,n)||this,o.isRecoverable=t,o.originalError=r,o}return babelHelpers.inheritsLoose(t,e),t})(babelHelpers.wrapNativeSuper(Error));a.exports={ConnectFailure:l,MqttChannelError:s,MqttError:e}}),null);
__d("PolarisMqttProtocolClient",["PolarisMqttEnv","PolarisMqttProtocolCodec","PolarisMqttProtocolUtils","PolarisMqttTypes"],(function(t,n,r,o,a,i){"use strict";var e,l=n("PolarisMqttEnv").Env,s=(e=n("PolarisMqttProtocolCodec")).MESSAGE_TYPE,u=e.WireMessage,c=e.createMessageWithString,d=e.decodeByteMessages,m=n("PolarisMqttProtocolUtils").Pinger,p=n("PolarisMqttProtocolUtils").concatBuffers,_=n("PolarisMqttTypes").ConnectFailure,f=n("PolarisMqttTypes").MqttError,g=30,h=6e4,y={APP_DISCONNECT:new f(7,"Disconnect initiated by app"),CONNACK_FAILURE:new f(5,"Connection failure due to connack"),CONNECT_TIMEOUT:new f(4,"Connect timed out"),INVALID_DATA_TYPE:new f(3,"Received non-arraybuffer from socket."),PING_TIMEOUT:new f(6,"Ping timeout"),SERVER_DISCONNECT:new f(8,"Disconnect message sent my server"),SOCKET_CLOSE:new f(9,"Socket connection closed"),SOCKET_ERROR:new f(1,"Socket error"),SOCKET_MESSAGE:new f(2,"Unable to parse invalid socket message")},C=(function(){function e(e){var t=this;this.$11=function(e,n){var r=t.$5,o=t.$2,a=o.onConnectFailure,i=o.onConnectionLost;t.setConnected(!1),r?l.scheduleCallback(function(){i(e)}):l.scheduleCallback(function(){a(new _(e,n!=null?n:-1))}),t.$13()},this.$12=function(e){var n=t.$6;n!=null&&n.readyState===n.OPEN&&n.send(e.encode())},this.handleMessage=function(e){switch(e.messageType){case s.CONNACK:if(t.$7!=null&&(l.clearTimeout(t.$7),t.$7=null),e instanceof u.ConnAck){var n=e;if(n.returnCode!==0){t.$9.bumpCounter("protocol.error.connack.invalidreturncode"),t.setConnected(!1),t.$11(y.CONNACK_FAILURE,n.returnCode);return}l.scheduleCallback(function(){t.$2.onConnectSuccess()}),t.$8!=null&&t.$8.reset()}break;case s.PUBLISH:if(e instanceof u.Publish){var r=e;l.scheduleCallback(function(){t.$2.onMessageArrived(r.topic,r.payloadMessage.payloadString)});var o=r.messageIdentifier;if(t.$9.bumpCounter("protocol.publish.received"),r.qos===1&&o!=null){var a=new u.PubAckUnsubAck("PUBACK",o);t.$12(a)}}break;case s.PUBACK:if(e instanceof u.PubAckUnsubAck){var i=e,c=i.messageIdentifier;t.$9.bumpCounter("protocol.puback.received"),l.scheduleCallback(function(){t.$2.onMessageDelivered(c)})}break;case s.PINGRESP:t.$8!=null&&t.$8.reset();break;case s.DISCONNECT:t.$11(y.SERVER_DISCONNECT);break;case s.SUBACK:t.$9.bumpCounter("protocol.suback.received");break;case s.UNSUBACK:t.$9.bumpCounter("protocol.unsuback.received");break;default:t.$9.logError(new Error("MqttProtocolClient: Received unhandled message type: "+e.messageType),"Received unhandled message type"),t.$9.bumpCounter("protocol.error.handlemessage.unsupportedtype");break}},this.$3=e,this.$2={ignoreSubProtocol:!1,keepAliveInterval:10,mqttVersion:3,onConnectFailure:function(t){},onConnection:function(){},onConnectionError:function(t){},onConnectionLost:function(t){},onConnectSuccess:function(){},onMessageArrived:function(t,n){},onMessageDelivered:function(t){},userName:""},this.$1="mqttwsclient",this.$4=0,this.$5=!1,this.$9=l.getLoggerInstance()}var t=e.prototype;return t.connect=function(t){var e=this;if(this.$5)throw new Error("Invalid state: connect - already connected");this.$2=t,this.setConnected(!1),this.$7!=null&&(l.clearTimeout(this.$7),this.$7=null),this.$7=l.setTimeout(function(){e.$9.bumpCounter("protocol.error.connect.timeout"),e.$11(y.CONNECT_TIMEOUT)},g*1e3),this.$6=l.createSocket(this.$3),this.$6.binaryType="arraybuffer",this.$6.onopen=function(){e.setConnected(!0),e.$12(new u.Connect(e.$1,t)),t.onConnection()},this.$6.onmessage=function(t){var n=t.data;if(!(n instanceof ArrayBuffer)){e.$9.bumpCounter("protocol.error.onmessage.type"),e.$11(y.INVALID_DATA_TYPE);return}try{var r=new Uint8Array(n);e.$10!=null&&(r=p(e.$10,r),e.$9.bumpCounter("protocol.debug.usingMessagesBuffer"),delete e.$10,e.$10=null);var o=d(r),a=o.messages;e.$10=o.remaining;for(var i=0;i<a.length;i++)e.handleMessage(a[i])}catch(t){e.$10=null,e.$9.logError(t,y.SOCKET_MESSAGE.errorMessage),e.$9.bumpCounter("protocol.error.onmessage.parse"),e.$11(y.SOCKET_MESSAGE)}},this.$6.onerror=function(t){e.$9.bumpCounter("protocol.error.socket"),e.$11(y.SOCKET_ERROR)},this.$6.onclose=function(t){e.$9.bumpCounter("protocol.socket.close"),e.$11(y.SOCKET_CLOSE)},this.$8!=null&&this.$8.cancel(),this.$8=new m(t.keepAliveInterval,this.$12.bind(this,new u.Ping("PINGREQ")),this.$11.bind(this,y.PING_TIMEOUT))},t.$13=function(){this.setConnected(!1),this.$8!=null&&this.$8.cancel(),this.$7!=null&&(l.clearTimeout(this.$7),this.$7=null),this.$6!=null&&(this.$6.onopen=function(e){},this.$6.onmessage=function(e){},this.$6.onerror=function(e){},this.$6.onclose=function(e){},this.$6.readyState===this.$6.OPEN&&this.$6.close(),delete this.$6,this.$6=null),this.$2.onConnectSuccess=function(){},this.$2.onConnectFailure=function(e){},this.$2.onConnection=function(){},this.$2.onConnectionError=function(e){},this.$2.onConnectionLost=function(e){},this.$2.onMessageArrived=function(e,t){},this.$2.onMessageDelivered=function(e){}},t.disconnect=function(){if(this.$6==null||this.$6.readyState!==this.$6.OPEN||!this.$5){this.$13();return}this.$12(new u.Disconnect),this.$9.bumpCounter("protocol.debug.disconnect"),this.$11(y.APP_DISCONNECT)},t.isConnected=function(){return this.$5},t.setConnected=function(t){this.$5=t},t.subscribe=function(t){if(!this.$5)throw this.$9.bumpCounter("protocol.error.subscribe.notconnected"),new Error("Invalid state: subscribe - not connected");this.$9.bumpCounter("protocol.subscribe."+t);var e=new u.Subscription("SUBSCRIBE",t,0,this.$14());this.$12(e)},t.unsubscribe=function(t){if(!this.$5)throw this.$9.bumpCounter("protocol.error.unsubscribe.notconnected"),new Error("Invalid state: unsubscribe - not connected");this.$9.bumpCounter("protocol.unsubscribe."+t);var e=new u.Subscription("UNSUBSCRIBE",t,0,this.$14());this.$12(e)},t.publish=function(t,n,r){this.$5||this.$9.bumpCounter("protocol.error.publish.notconnected"),this.$9.bumpCounter("protocol.publish."+t);var e=this.$14(),o=new u.Publish(t,c(n),r,e);return this.$12(o),e},t.$14=function(){return++this.$4===h&&(this.$4=1),this.$4},e})();a.exports=C}),null);
__d("PolarisMqttUserName",[],(function(t,n,r,o,a,i){"use strict";var e=(function(){function e(e,t,n,r,o,a,i){this.$1=e,this.$2=t,this.$3=n,this.$4=r,this.$5=o,this.$6=a,this.$8=i,this.$7=typeof document=="object"&&document&&document.hasFocus()}var t=e.prototype;return t.gen=function(t,n,r){var e={a:navigator.userAgent,aid:this.$5,asi:void 0,chat_on:this.$6,cp:this.$3,ct:"cookie_auth",d:this.$4,dc:"",ecp:this.$2,fg:this.$7,mqtt_sid:"",no_auto_fg:!0,pm:r,s:t,st:n,u:this.$1};return this.$8&&this.$8.appSpecificInfo&&(e.asi=this.$8.appSpecificInfo),JSON.stringify(e)},t.setForegroundState=function(t){this.$7=t},t.setChatVisibility=function(t){this.$6=t},e})();i.default=e}),66);
__d("PolarisMqttConnection",["InstagramODS","PolarisMqttConnectionHookCollection","PolarisMqttEnv","PolarisMqttProtocolClient","PolarisMqttTypes","PolarisMqttUserName","PolarisMqttUtils","Promise","getErrorSafe"],(function(t,n,r,o,a,i,l){"use strict";var e,s=10,u="publish",c="subscribe",d="unsubscribe";function m(e){}var p=18e4,_=5*1e3,f=15,g=21,h=(function(){function t(e){this.$8=!1,this.$10=r("PolarisMqttEnv").Env.getLoggerInstance(),this.$11="Disconnected",this.$14=new Set,this.$15=new Map,this.$17=0,this.$18=0,this.$12=0,this.$13=0,this.$8=!1,this.$5="",this.$6=new(r("PolarisMqttUserName"))("0",0,1,"",0,!0),this.$9=0,this.$7=null;var t=function(){};this.$1=t,this.$2=t,this.$3=t,this.$19=new(r("PolarisMqttConnectionHookCollection")),this.$4=function(){return[]},this.$16=e}var o=t.prototype;return o.run=function(t){var e=this,n=t.endpoint,r=t.extraConnectMessageProvider,o=t.mqttUserName,a=t.onJSError,i=t.onMessageReceived,l=t.onStateChange,s=t.subscribedTopics;if(this.$8){this.$10.debugTrace("run","Run called while in running state.");return}this.$1=l,this.$3=i,this.$5=n,this.$6=o,this.$8=!0,this.$12=0,this.$2=a||m,s&&s.forEach(function(t){return e.$14.add(t)}),this.$4=r,this.$20()},o.shutdown=function(){this.$21(),this.$22("shutdown"),this.$8=!1,this.$10.debugTrace("shutdown","Shutdown")},o.subscribe=function(t){return this.$14.add(t),this.ensureConnected(c)&&this.$23(t),!0},o.publish=function(r,o,a){var t={reject:function(t){},resolve:function(){}},i=new(e||(e=n("Promise")))(function(e,n){t.resolve=e,t.reject=n}),l=this.ensureConnected(u),s="connection_unknown";if(!l)s="connection_not_connected",t.reject(new Error("Client disconnected"));else{var c=this.$24(r,o,a,t);s=c===!0?"connection_published":"connection_failed"}return this.$10.eventLogPublish({connectionStatus:l,publishStatus:s,sessionID:this.$9,topic:r}),i},o.unsubscribe=function(t){return this.$14.delete(t),this.ensureConnected(d)&&this.$25(t),!0},o.addHook=function(t){this.$19.addHook(t)},o.removeHook=function(t){this.$19.removeHook(t)},o.isRunning=function(){return this.$8},o.getSessionId=function(){return this.$9},o.ensureConnected=function(t){if(!this.$8)return this.$10.debugTrace("ensureConnected","Mqtt connection: "+t+" called when not running"),!1;if(this.$7==null)return this.$10.debugTrace("ensureConnected","Mqtt connection: "+t+" called when not connected, ignored"),!1;var e=this.$7.isConnected();return e?!0:(this.$10.debugTrace("ensureConnected","Mqtt connection: "+t+" called with client not connected"),!1)},o.connectionState=function(){return this.$11},o.testOnlyGetSubscribedTopics=function(){return this.$14},o.$21=function(){this.$8&&this.$7!=null&&(this.$26("Disconnected"),this.$7!=null&&this.$7.disconnect(),this.$7=null)},o.$26=function(t){t!==this.$11&&(this.$11=t,this.$1(t))},o.$20=function(){var e=this;if(this.$8){this.$26("Connecting");var t=Date.now();this.$9=r("PolarisMqttUtils").generateSessionId();var n=Array.from(this.$14),o=r("PolarisMqttUtils").endpointWithSessionId(this.$5,this.$9);try{this.$7=new(r("PolarisMqttProtocolClient"))(o);var a=this.$27(),i=a.map(function(e){return e.topic}),l=this.$6.gen(this.$9,n,a);this.$7!=null&&(this.$7.connect({ignoreSubProtocol:!0,keepAliveInterval:s,mqttVersion:3,onConnectFailure:function(o){return e.$28(o,t,n,i)},onConnection:function(){return e.$29(a,n)},onConnectionError:function(n){return e.$30(n)},onConnectionLost:function(n){return e.$31(n)},onConnectSuccess:function(){return e.$32(t,n,i)},onMessageArrived:function(n,r){return e.$33(n,r)},onMessageDelivered:function(n){return e.$34(n)},userName:l}),r("InstagramODS").incr("web.mqtt.protocol.connectattempt"),this.$19.onConnectAttempt())}catch(e){var u=r("getErrorSafe")(e);r("InstagramODS").incr("web.mqtt.js_error_in_init_exception"),this.$26("Disconnected"),this.$35(!1,t,n,[],14,u.message),u&&this.$10.logErrorWarn(u,"ws_js_error"),this.$19.onWSFatal(),this.$36(new(r("PolarisMqttTypes")).MqttChannelError(!1,"ws_js_error",u),"client_init")}}},o.$27=function(){var e=this.$4(),t=65536;return e.map(function(e){return e.messageId=t--,e})},o.$23=function(t){try{if(this.$7!=null)return this.$7.subscribe(t),this.$10.debugTrace("#doSubscribe","Subscribing to "+t),this.$19.onSubscribe(t),r("InstagramODS").incr("web.mqtt.protocol.subscribe"),!0}catch(t){var e=r("getErrorSafe")(t);this.$10.logError(e,"Exception subscribing"),r("InstagramODS").incr("web.mqtt.subscribe_exception"),r("InstagramODS").incr("web.mqtt.protocol.subscribe.error")}return!1},o.$25=function(t){try{if(this.$7!=null)return this.$7.unsubscribe(t),this.$10.debugTrace("#doUnsubscribe","Unsubscribing to "+t),this.$19.onUnsubscribe(t),r("InstagramODS").incr("web.mqtt.protocol.unsubscribe"),!0}catch(t){var e=r("getErrorSafe")(t);this.$10.logError(e,"Exception unsubscribing"),r("InstagramODS").incr("web.mqtt.unsubscribe_exception"),r("InstagramODS").incr("web.mqtt.protocol.unsubscribe.error")}return!1},o.$24=function(t,n,o,a){if(this.$7!=null)try{var e=this.$7.publish(t,n,o);r("InstagramODS").incr("web.mqtt.protocol.publish");var i=e!=null?e:"null";return this.$10.debugTrace("#doPublish","publish "+t+" with messageId:"+i+" qos:"+o),this.$19.onPublish(t),e!=null?this.$15.set(e,a):a.resolve(),!0}catch(e){var l=r("getErrorSafe")(e);return this.$10.logError(l,"Exception publishing"),r("InstagramODS").incr("web.mqtt.publish_exception"),a.reject(l),r("InstagramODS").incr("web.mqtt.protocol.publish.error"),!1}else return!1},o.$37=function(t){var e=this;if(t===void 0&&(t=null),!!this.$8){this.$21(),this.$22("reconnect"),this.$38(),this.$9=-1,this.$13=0;var n=t!=null?t:Math.pow(2,Math.min(this.$12,6))*(1e3+r("PolarisMqttEnv").Env.random()*200);this.$10.debugTrace("#scheduleReconnect","Reconnect in "+n+" ms"),r("PolarisMqttEnv").Env.setTimeout(function(){e.$20()},n),this.$12+=1}},o.$38=function(){if(r("PolarisMqttEnv").Env.genGk(r("PolarisMqttEnv").MqttGkNames.mqtt_ws_reconnect_reset)){var e=Date.now()-this.$13,t=this.$13!==0&&e>_,n=this.$12>f;(t||n)&&(this.$12=0),this.$13!==0&&e<=_&&r("InstagramODS").incr("web.mqtt.short_lived_session"),n&&r("InstagramODS").incr("web.mqtt.connection_attempt_limit")}},o.$35=function(t,n,r,o,a,i){t===!0?this.$18++:this.$17++,this.$10.eventLogConnect({attemptNumber:this.$12,connectionStatus:t,duration:Date.now()-n,errorCode:a,errorMessage:i,failTotal:this.$17,hostname:this.$5,publishes:o,sessionID:this.$9,subscribedTopics:r,successTotal:this.$18})},o.$28=function(t,n,o,a){var e=t.mqttError,i=e.errorMessage;if(this.$10.debugTrace("connect","Connect failed "+i),r("InstagramODS").incr("web.mqtt.protocol.onconnectfailure"),this.$19.onConnectFailure(),this.$35(!1,n,o,a,e.errorCode,i),t.connAck!=null&&(r("InstagramODS").incr("web.mqtt.protocol.connect_failure"),t.connAck===g)){this.$37(p);return}this.$37()},o.$29=function(t,n){var e=this;r("InstagramODS").incr("web.mqtt.protocol.onconnection"),this.$10.debugTrace("Connect","Socket established"),this.$19.onConnected(),n.forEach(function(t){e.$19.onSubscribe(t)}),t.forEach(function(t){e.$19.onPublish(t.topic)}),this.$26("TransportConnected")},o.$32=function(t,n,o){r("InstagramODS").incr("web.mqtt.protocol.onconnectsuccess"),this.$10.debugTrace("connect","Connect success"),this.$19.onConnectSuccess(),this.$35(!0,t,n,o),this.$26("Connected"),this.$39(n),r("PolarisMqttEnv").Env.genGk(r("PolarisMqttEnv").MqttGkNames.mqtt_ws_reconnect_reset)||(this.$12=0),this.$13=Date.now()},o.$31=function(t){r("InstagramODS").incr("web.mqtt.protocol.onconnectionlost"),t.errorCode&&this.$10.eventLogDisconnect({duration:Date.now()-this.$13,errorCode:t.errorCode,errorMessage:t.errorMessage,sessionID:this.$9}),this.$10.debugTrace("connect","connection lost"),this.$19.onConnectionLost(),this.$37()},o.$30=function(t){},o.$33=function(t,n){r("InstagramODS").incr("web.mqtt.protocol.onmessagearrived"),this.$10.debugTrace("onMessageArrived","Message received on "+t),this.$19.onMessage(t);try{this.$3(t,n)}catch(t){var e=r("getErrorSafe")(t);this.$10.logError(e,"Listener threw error"),r("InstagramODS").incr("web.mqtt.listener_error")}},o.$34=function(t){r("InstagramODS").incr("web.mqtt.protocol.onmessagedelivered");var e=t!=null?t:"null";if(this.$10.debugTrace("onMessageDelivered","Delivered Message {ID: "+e+"}"),t!=null){var n=this.$15.get(t);n!=null&&(this.$15.delete(t),n.resolve())}},o.$22=function(t){this.$15.forEach(function(e,n,r){e.reject(new Error(t))}),this.$15.clear()},o.$39=function(t){var e=this,n=new Set(t);n.forEach(function(t){e.$14.has(t)||e.unsubscribe(t)});var r=new Set(this.$14);r.forEach(function(t){n.has(t)||e.subscribe(t)})},o.$36=function(t,n){try{r("InstagramODS").incr("web.mqtt.js_error_in_init");var e=t?t.message:"error";this.$10.debugTrace("onError",n+": "+e),this.$2(t)}catch(e){var o=r("getErrorSafe")(e);r("InstagramODS").incr("web.mqtt.js_error_in_error_logging"),this.$10.logError(o,"JS error while trying to log previous error")}},t})();l.default=h}),98);
__d("PolarisMqttChannel",["FBLogger","InstagramODS","PolarisChannelClientID","PolarisIrisSubscribeChecker","PolarisMqttAnalyticsHook","PolarisMqttConnection","PolarisMqttEnv","PolarisMqttUserName","PolarisMqttUtils","Promise","getErrorSafe","uuidv4"],(function(t,n,r,o,a,i,l){"use strict";var e,s=6e4,u=(function(){function t(e){var t=this,n=e.appId,o=e.capabilities,a=e.chatVisibility,i=a===void 0?!0:a,l=e.clientCapabilities,s=e.endpoint,u=e.igSpecificOptions,c=e.initialSubscribedTopics,d=e.observer,m=e.userFbid;this.$8=r("PolarisMqttEnv").Env.getLoggerInstance(),this.$8.setAppId(n),this.$9=new(r("PolarisMqttUserName"))(m,o,l,r("PolarisChannelClientID").getID(),n,i,u),this.$1=s,this.$5="Disconnected",this.$2=[d],this.$4=new Set,this.$6=new Map,this.$7=new(r("PolarisMqttConnection"))(u),(u==null?void 0:u.deviceId)!=null?this.$3=u.deviceId:this.$3=r("uuidv4")(),this.$13=new(r("PolarisMqttAnalyticsHook")),this.$7.addHook(this.$13),this.$7.addHook(new(r("PolarisIrisSubscribeChecker"))(function(){return t.$4.size>0})),this.$10=!1,this.$12=new Map,this.$11=[],this.$14(c)}var o=t.prototype;return o.$14=function(t){var e=this;if(this.$7.isRunning()){this.$15("run","Connection started calling run again");return}if(r("PolarisMqttEnv").Env.genGk(r("PolarisMqttEnv").MqttGkNames.mqtt_ws_polling_enabled)){if(r("PolarisMqttEnv").Env.genGk(r("PolarisMqttEnv").MqttGkNames.mqtt_ws_forced_polling_only)){this.$15("MqttChannel","Websocket disabled, will do long polling only");return}else if(!r("PolarisMqttUtils").hasWSSupport()){this.$15("MqttChannel","Websocket Unavailable, will do long polling only"),r("InstagramODS").incr("web.mqtt.ws_unavailable_polling");return}}this.$7.run({endpoint:this.$1,extraConnectMessageProvider:function(){return e.$16()},mqttUserName:this.$9,onJSError:function(n){e.$17(n)},onMessageReceived:function(n,r){e.$18(n,r)},onStateChange:function(n){e.$19(n)},subscribedTopics:t})},o.shutdown=function(){this.$7&&this.$7.shutdown()},o.publish=function(t,n,r){return r===void 0&&(r={qos:1,skipBuffer:!1}),r.qos===0?this.$20(t,n):this.$21(t,n,r)},o.$20=function(t,n){return this.$7.publish(t,n,0)},o.$21=function(o,a,i){var t={reject:function(t){},resolve:function(){}},l=new(e||(e=n("Promise")))(function(e,n){t.resolve=e,t.reject=n}),s=r("PolarisMqttEnv").Env.random(),u={ack:t,options:i,payload:a,publishToken:s,timeoutId:null,topic:o};return i.skipBuffer?this.$7.connectionState()==="Connecting"?this.$11.push(u):this.$22(u):(u.timeoutId=this.$23(s),this.$12.set(s,u),this.$24(u)),l},o.$22=function(t){r("PolarisMqttUtils").promiseDone(this.$7.publish(t.topic,t.payload,t.options.qos),function(){t.ack.resolve()},function(e){t.ack.reject(e)})},o.$24=function(t){var e=this;r("PolarisMqttUtils").promiseDone(this.$7.publish(t.topic,t.payload,t.options.qos),function(){return e.$25(t)},function(){})},o.subscribe=function(t,n){this.$7.subscribe(t);var e=this.$6.get(t);e?e.push(n):(e=[n],this.$6.set(t,e))},o.subscribeChannelEvents=function(t){this.$2.push(t)},o.registerExtraConnectPayloadProvider=function(t){var e=this;if(this.$4.add(t),this.$7.isRunning()){var n=t.getPublishMessages();n.forEach(function(t){e.publish(t.topic,t.payload,{qos:t.qos,skipBuffer:!0}).catch(function(t){return e.$8.logError(t,t==null?void 0:t.message)})})}},o.unregisterExtraConnectPayloadProvider=function(t){this.$4.delete(t)},o.unsubscribe=function(t){this.$7.unsubscribe(t),this.$6.delete(t)},o.getConnectionState=function(){return this.$5},o.getEndpoint=function(){return this.$1},o.addHook=function(t){this.$7.addHook(t)},o.removeHook=function(t){this.$7.removeHook(t)},o.testOnlyMessageReceived=function(t,n){this.$18(t,n)},o.$26=function(t){var e=this.$12.get(t);e!=null&&e.timeoutId!=null&&r("PolarisMqttEnv").Env.clearTimeout(e.timeoutId),this.$12.delete(t)},o.$23=function(t){var e=this;return r("PolarisMqttEnv").Env.setTimeout(function(t){var n=e.$12.get(t);if(n){var o=n.topic;r("InstagramODS").incr("web.mqtt.publish_timeout"),e.$8.debugTrace("publish_timeout","Timeout publishing topic: "+o+" publishToken: "+t),e.$26(t),n.ack.reject(new Error("Publish Timed Out"))}},s,t)},o.$25=function(t){var e=t.publishToken,n=this.$12.get(e);n&&(this.$26(e),t.ack.resolve(),this.$8.debugTrace("publish_success","Topic: "+t.topic+" publishToken: "+t.publishToken),r("InstagramODS").incr("web.mqtt.publish_success"))},o.$18=function(t,n){var e=this.$6.get(t);if(!e)this.$8.debugTrace("_onMessageReceived",t+" being dropped, no listeners");else for(var o of e)try{o(n)}catch(e){var a=r("getErrorSafe")(e);this.$8.logError(a,"Listener exception"),r("InstagramODS").incr("web.mqtt.listener_error")}},o.$17=function(t){if(r("PolarisMqttEnv").Env.genGk(r("PolarisMqttEnv").MqttGkNames.mqtt_ws_polling_enabled)){t.isRecoverable?r("InstagramODS").incr("web.mqtt.recoverable_error_skipped"):r("InstagramODS").incr("web.mqtt.unrecoverable_error_skipped");return}t.isRecoverable?r("InstagramODS").incr("web.mqtt.recoverable_error_not_skipped"):r("InstagramODS").incr("web.mqtt.unrecoverable_error_not_skipped"),t.isRecoverable||(this.$10=!0),this.$27(t)},o.$27=function(t){for(var e of this.$2)e.onJSError&&e.onJSError(t)},o.$19=function(t){var e=this;t==="Connecting"?(this.$11.forEach(function(e){e.ack.reject(new Error("Client Reconnecting"))}),this.$11=[]):t==="TransportConnected"&&(this.$11.forEach(function(t){e.$22(t)}),this.$11=[],this.$12.forEach(function(t,n,r){e.$24(t)})),this.$5=this.$28(t),this.$15("_changeState","Connection state = "+t),this.$29()},o.$28=function(t){switch(t){case"Connecting":case"TransportConnected":return"Connecting";case"Connected":return"Connected";case"Disconnected":return"Disconnected"}throw r("FBLogger")("ig_web").mustfixThrow("Unknown state "+t)},o.$29=function(){for(var e of this.$2)e.onMQTTStateChanged(this.$5)},o.$16=function(){var e=this,t=[];return this.$4.forEach(function(n){try{var o=n.getPublishMessages();Array.prototype.push.apply(t,o)}catch(t){var a=r("getErrorSafe")(t);e.$8.logError(a,"ConnectPayload provider exception"),r("InstagramODS").incr("web.mqtt.connectPayloadProvider_error")}}),t},o.$15=function(t,n){this.$8.debugTrace(t,"Mqtt channel: "+n)},o.setForegroundState=function(t){this.$9&&this.$9.setForegroundState(t)},o.setChatVisibility=function(t){this.$9&&this.$9.setChatVisibility(t)},t})();l.default=u}),98);
__d("PolarisMqttLogger",["InstagramODS","PolarisChannelClientID","PolarisDirectLogger","PolarisMqttEnv"],(function(t,n,r,o,a,i,l){"use strict";var e="mqtt_client",s=null,u=new(o("PolarisDirectLogger")).DirectLogger(e,r("PolarisChannelClientID").getID()),c={CLIENT_ERROR:"mqtt_client_error",CONNECT:"mqtt_client_connect",DISCONNECT:"mqtt_client_disconnect",PUBLISH:"mqtt_client_publish"},d=(function(){function e(){this.$1=0,this.$2=Date.now(),this.$3=r("PolarisChannelClientID").getID()}e.getInstance=function(){return s||(s=new e),s};var t=e.prototype;return t.setAppId=function(t){this.$1===0&&(this.$1=t)},t.eventLogConnect=function(t){var e=t.attemptNumber,n=t.connectionStatus,o=t.duration,a=t.errorCode,i=t.errorMessage,l=t.failTotal,s=t.hostname,u=t.publishes,d=t.sessionID,m=t.subscribedTopics,p=t.successTotal;n?r("InstagramODS").incr("web.mqtt.mqtt_client_connect.success"):r("InstagramODS").incr("web.mqtt.mqtt_client_connect.failed");var _={attempt_number:e,connection_status:n,device_id:this.$3,duration:o,error_code:a,error_message:i,hostname:s,href:window.location.hostname,logged_in:r("PolarisMqttEnv").Env.isUserLoggedInNow(),publishes:u,session_id:d,subscribed_topics:m};this.$4(c.CONNECT,_)},t.eventLogPull=function(t){var e=t.duration,n=t.errorMessage,o=t.hostname,a=t.pullEventName,i=t.sessionID,l=t.status,s={connection_status:l,device_id:this.$3,duration:e,error_message:n,hostname:o,href:window.location.hostname,logged_in:r("PolarisMqttEnv").Env.isUserLoggedInNow(),session_id:i};this.$4(a,s)},t.eventLogDisconnect=function(t){var e=t.duration,n=t.errorCode,o=t.errorMessage,a=t.sessionID;r("InstagramODS").incr("web.mqtt.mqtt_client_disconnect");var i={device_id:this.$3,duration:e,error_code:n,error_message:o,href:window.location.hostname,session_id:a};this.$4(c.DISCONNECT,i)},t.eventLogPublish=function(t){var e=t.connectionStatus,n=t.publishStatus,o=t.sessionID,a=t.topic;r("InstagramODS").incr("web.mqtt.mqtt_client_publish"),r("InstagramODS").incr_CAREFUL_WHEN_USE_DYNAMIC_KEY("web.mqtt.mqtt_client_publish."+a)},t.logError=function(t,n){r("PolarisMqttEnv").Env.scheduleLoggingCallback(function(){u.logError(n,t)})},t.eventLogMiscellaneousError=function(t){var e=t.errorMessage,n={device_id:this.$3,error_message:e,href:window.location.hostname,logged_in:r("PolarisMqttEnv").Env.isUserLoggedInNow(),time_passed:Date.now()-this.$2};this.$4(c.CLIENT_ERROR,n)},t.logErrorWarn=function(t,n){r("PolarisMqttEnv").Env.scheduleLoggingCallback(function(){u.logError(n,t)})},t.logWarn=function(t,n){},t.debugTrace=function(t,n){r("PolarisMqttEnv").Env.scheduleLoggingCallback(function(){u.debugTrace(t,n)})},t.bumpCounter=function(t){},t.$4=function(t,n){var e=this;r("PolarisMqttEnv").Env.scheduleLoggingCallback(function(){n.event_type=t,n.app_id=e.$1,n.online=e.$5(),u.logDirectEvent(t,n)})},t.$5=function(){return window.navigator&&window.navigator.onLine!==void 0?window.navigator.onLine:!1},e})();l.default=d}),98);
__d("polarisSetTimeoutAcrossTransitions",[],(function(t,n,r,o,a,i){"use strict";function e(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return setTimeout.apply(void 0,[e,t].concat(r))}i.default=e}),66);
__d("PolarisMqttEnvInitializer",["PolarisIsLoggedIn","PolarisMqttEnv","PolarisMqttLogger","PolarisWebStorage","polarisSetTimeoutAcrossTransitions"],(function(t,n,r,o,a,i,l){"use strict";var e="mqtt:",s={initialize:function(){r("PolarisMqttEnv").Env.initialize(null,o("PolarisIsLoggedIn").isLoggedIn,null,r("polarisSetTimeoutAcrossTransitions"),function(){return r("PolarisMqttLogger").getInstance()},null,null,null,null,function(t,n){var o=r("PolarisWebStorage").getLocalStorage();if(o){var a=o.getItem(e+t);if(a!=null)return a}return n},function(t,n){var o=r("PolarisWebStorage").getLocalStorage();o&&(n==null?o.removeItem(e+t):o.setItem(e+t,n))})}},u=s;l.default=u}),98);
__d("PolarisDirectMQTT",["InstagramODS","MercuryLocalIDs","PolarisCallGatingHelpers","PolarisConfig","PolarisDeviceOrMachineId","PolarisDirectConstants","PolarisDirectDeltaHandlers","PolarisDirectGraphQLSubscription","PolarisDirectIrisSubscription","PolarisDirectLogger","PolarisDirectSkywalkerSubscription","PolarisLiveDeltaHandler","PolarisLocales","PolarisMediaOverlayInfoTypes","PolarisMqttChannel","PolarisMqttEnvInitializer","PolarisReactRedux.react","nullthrows","polarisArraySplitChunks","polarisDeveloperSettings","polarisForEachAsync","randomInt"],(function(t,n,r,o,a,i,l){"use strict";var e=20,s=(function(){function t(t,n){var a=this;this.$8=0,this.$14=function(e){var t;try{t=JSON.parse(e.substr(0,e.length-1))}catch(e){a.$4.logError("Could not parse mqttMessages",e);return}var n=t.payload.header;if(n.type===4&&n.conferenceName.includes("ROOM")){var o,i,l=((o=t.payload.body)==null||(o=o.ringRequest)==null?void 0:o.ringType)%2===1,s=(i=t.payload.body)==null||(i=i.ringRequest)==null||(i=i.appMessages)==null?void 0:i.find(function(e){return e.body.genericMessage.topic==="ring_data"}),u="",c="",d="",m=[];if(s){var p,_=JSON.parse(s==null||(p=s.body)==null||(p=p.genericMessage)==null?void 0:p.data),f=_.display_name,g=_.display_uri,h=_.group_name,y=_.ig_thread_id,C=_.participant_usernames;if(u=y,d=f,m.push(g),h)c=h;else{var b=C;try{b=JSON.parse(C)}catch(e){}c=Array.isArray(b)?[f].concat(b).join(", "):f}}a.$6(n.type,n.serverInfoData,u,l,c,m,d),r("InstagramODS").incr("web.rtc.ack_ring_message"),a.$15(n.conferenceName,n.sequenceNumber,n.serverInfoData,n.transactionId,n.type,n.conferenceType)}else n.type===5&&n.conferenceName.includes("ROOM")?(a.$6(n.type,n.serverInfoData,"",!1,"",[],""),r("InstagramODS").incr("web.rtc.ack_dismiss_message"),a.$15(n.conferenceName,n.sequenceNumber,n.serverInfoData,n.transactionId,n.type,n.conferenceType)):r("InstagramODS").incr("web.rtc.rtc_message_ignored")},this.$16=function(t){var n=r("nullthrows")(a.$1),i;try{i=JSON.parse(t)}catch(e){a.$4.logError("Could not parse mqttMessages",e);return}if(!Array.isArray(i)){a.$4.debugTrace("parsed_message_not_array",typeof i);return}r("polarisForEachAsync")(r("polarisArraySplitChunks")(i,e),function(e){o("PolarisReactRedux.react").batch(function(){for(var t of e){var r=t.data,o=t.event,i=t.mutation_token,l=t.seq_id;if(a.$4.debugTrace("parsed_message",{event:o,mutation_token:i}),o!=="patch"){a.$4.debugTrace("skipped_message",{event:o});return}if(!Array.isArray(r)){a.$4.debugTrace("parsed_message_bad_operations",typeof r);return}for(var s of r)n.handleDelta(s,i);if(l){var u=a.$2.subscription_type;a.$4.debugTrace("seq_id",{seq_id:l,subscriptionType:u}),u==="message"&&n.onSeqIdUpdated(l)}}})})},this.$17=function(e){try{var t=JSON.parse(e);if(t.status==="ok"){var n;(t==null||(n=t.payload)==null?void 0:n.activity_status)==null?a.$4.logDirectEvent("send_message_response_success"):a.$4.logDirectEvent("send_activity_response_success")}else{var r;(t==null||(r=t.payload)==null?void 0:r.activity_status)==null?a.$4.logError("send_message_response_failed"):a.$4.logDirectEvent("send_activity_response_failed")}}catch(e){a.$4.logError("send_message_response_parse_failed",e)}},this.$18=function(e){a.$4.debugTrace("state_changed",e);var t=r("nullthrows")(a.$1);if(e==="Connected"){var n=r("nullthrows")(a.$5);n.subscribe("/ig_message_sync",a.$16),n.subscribe("/ig_send_message_response",a.$17),o("PolarisCallGatingHelpers").isIncomingCallEnabled()&&!o("PolarisCallGatingHelpers").isWebCallingEnabled()&&n.subscribe("/pubsub",a.$14),a.$3||(a.$3=new(o("PolarisDirectIrisSubscription")).DirectIrisSubscription(t,a.$2,n,a.$4.getDebugId())),a.$3.subscribe(),a.$10||(a.$10=new(o("PolarisDirectGraphQLSubscription")).DirectGraphQLSubscription(t,n,a.$4.getDebugId())),a.$2.subscription_type==="message"?(a.$9||(a.$9=new(o("PolarisDirectSkywalkerSubscription")).DirectSkywalkerSubscription(t,n,a.$4.getDebugId())),a.$9.subscribe()):a.$4.debugTrace("skip_skywalker",a.$2),a.$10&&a.$10.subscribe()}else if(e==="Disconnected"){a.$3&&(a.$3.unsubscribe(),a.$3=null),a.$9&&(a.$9.unsubscribe(),a.$9=null),a.$10&&(a.$10.unsubscribeGraphQL(),a.$10=null);var i=a.$5;i&&(i.unsubscribe("/ig_message_sync"),i.unsubscribe("/ig_send_message_response"),o("PolarisCallGatingHelpers").isIncomingCallEnabled()&&!o("PolarisCallGatingHelpers").isWebCallingEnabled()&&i.unsubscribe("/pubsub"))}t.onMqttConnectivityChanged(e)},this.$4=new(o("PolarisDirectLogger")).DirectLogger("DirectMQTT",n),this.$4.debugTrace("ctor",t),this.$1=null,this.$2=t,this.$3=null,this.$5=null,this.$9=null,this.$10=null}var n=t.prototype;return n.$11=function(){return r("nullthrows")(o("PolarisConfig").getViewerId())},n.$12=function(){return parseInt(o("PolarisConfig").getIGAppID(),10)},n.$13=function(){return o("PolarisDeviceOrMachineId").getDeviceOrMachineId()},n.$15=function(t,n,o,a,i,l){var e=this;if(this.$7==null){var s=r("randomInt")(0,4294967294)+1;this.$7=String(s)}var u={endpoint:{appId:this.$12(),deviceId:this.$13(),userId:this.$11()},jsonPayload:{body:{ringResponse:{deviceCapabilities:[],deviceStatus:0}},header:{clientSessionId:this.$7,clientStack:5,conferenceName:t,conferenceType:l,messageTags:[],responseStatusCode:200,retryCount:0,sequenceNumber:n,serverInfoData:o,transactionId:a,type:i}}};r("nullthrows")(this.$5).publish("/rtc_multi",JSON.stringify(u)).catch(function(t){var n,o;i===4?r("InstagramODS").incr("web.rtc.ack_ring_message_failed"):i===5?r("InstagramODS").incr("web.rtc.ack_dismiss_message_failed"):r("InstagramODS").incr("web.rtc.ack_message_failed");var a=(n=(o=e.$5)==null?void 0:o.getConnectionState())!=null?n:"Unknown";throw e.$4.logError("ack_rtc_message_failed",t,{conference_type:l,message_type:i,mqtt_state:a}),t})},n.$19=function(t){var e,n=this,a=(e=t.item_type)!=null?e:"";return this.$4.logDirectEvent("send_attempt",{action:t.action,type:a}),r("nullthrows")(this.$5).publish("/ig_send_message",JSON.stringify(babelHelpers.extends({client_context:o("MercuryLocalIDs").generateOfflineThreadingID(),device_id:this.$13()},t))).catch(function(e){throw n.$4.logError("send_message_failed",e),e})},n.sendRtcHangupRequest=function(t){var e=this,n={endpoint:{appId:this.$12(),deviceId:this.$13(),userId:this.$11()},jsonPayload:{body:{hangupRequest:{detailedReasonString:"",reason:0}},header:{clientSessionId:this.$7,clientStack:5,messageTags:[],retryCount:0,sequenceNumber:this.$8++,serverInfoData:t,transactionId:String(r("randomInt")(0,4294967294)+1),type:2}}};return r("nullthrows")(this.$5).publish("/rtc_multi",JSON.stringify(n)).catch(function(t){throw e.$4.logError("send_rtc_hangup_message_failed",t),t})},n.sendTextMessage=function(t,n,r,a,i){return this.$19({action:"send_item",item_type:o("PolarisDirectConstants").ThreadItemType.TEXT,mutation_token:r,replied_to_client_context:i,replied_to_item_id:a,text:n,thread_id:t})},n.sendMediaShare=function(t,n,r,a){var e=o("PolarisDirectConstants").ThreadItemType.MEDIA_SHARE;return a==="clips"&&(e=o("PolarisDirectConstants").ThreadItemType.CLIP_SHARE),(r==null?void 0:r.overlay_layout)===o("PolarisMediaOverlayInfoTypes").MEDIA_OVERLAY_LAYOUTS.MEDIA_COVER||(r==null?void 0:r.overlay_layout)===o("PolarisMediaOverlayInfoTypes").MEDIA_OVERLAY_LAYOUTS.MEDIA_COVER_WITH_BOTTOM_BANNER?this.$19({action:"send_item",item_type:e,media_id:n,share_treatment_title:o("PolarisDirectConstants").InformTreatmentTitleValues.FALLBACK,share_treatment_type:o("PolarisDirectConstants").InformTreatmentTypeValues.WARNING_SCREENS,thread_id:t}):this.$19({action:"send_item",item_type:e,media_id:n,thread_id:t})},n.sendClipShareWithSocialContext=function(t,n,r,a,i){return this.$19({action:"send_item",item_type:o("PolarisDirectConstants").ThreadItemType.CLIP_SHARE,media_id:n,recipient_users:i!=null?i:void 0,social_context_share_type:a,text:r,thread_id:t})},n.sendLike=function(t,n){return this.$19({action:"send_item",item_type:o("PolarisDirectConstants").ThreadItemType.LIKE,mutation_token:n,thread_id:t})},n.indicateTypingActivity=function(t,n){return this.$19({action:"indicate_activity",activity_status:t,thread_id:n})},n.markVisualItemSeen=function(t,n){return this.$19({action:"mark_visual_item_seen",item_ids:JSON.stringify([t]),target_item_type:"voice_media",thread_id:n})},n.modifyLikeReaction=function(t,n,r,o,a){return this.$19({action:"send_item",emoji:a!=null?a:"",item_id:t,item_type:"reaction",node_type:"item",reaction_status:o,reaction_type:"like",target_item_type:n,thread_id:r})},n.disconnect=function(){this.$4.debugTrace("disconnect_start"),this.$3?(this.$4.debugTrace("unsubscribe_iris"),r("nullthrows")(this.$3).unsubscribe(),this.$3=null):this.$4.debugTrace("no_iris"),this.$9?(this.$4.debugTrace("unsubscribe_skywalker"),this.$9=null):this.$4.debugTrace("no_skywalker"),this.$10?(this.$4.debugTrace("unsubscribe_graphql"),this.$10=null):this.$4.debugTrace("no_graphql"),this.$5?(this.$4.debugTrace("shutdown_channel"),r("nullthrows")(this.$5).shutdown(),this.$5=null):this.$4.debugTrace("no_channel"),this.$1&&(this.$1=null),this.$4.debugTrace("disconnect_end")},n.connect=function(t,n){var e=this;this.$4.debugTrace("connect_start"),this.disconnect(),this.$1=new(o("PolarisDirectDeltaHandlers")).DirectDeltaHandlers(t,this.$4.getDebugId()),this.$6=n;var a={onJSError:function(n){e.$4.logError("mqtt_js_error",n)},onMQTTStateChanged:this.$18},i={appSpecificInfo:{},deviceId:this.$13()},l=r("PolarisLocales").language_code;l!=null&&(i.appSpecificInfo["Accept-Language"]=l),r("PolarisMqttEnvInitializer").initialize();var s={appId:this.$12(),capabilities:0,chatVisibility:!0,clientCapabilities:1,endpoint:o("PolarisDirectConstants").PROD_MQTT_GATEWAY,igSpecificOptions:i,initialSubscribedTopics:[],observer:a,userFbid:this.$11()};this.$5=new(r("PolarisMqttChannel"))(s),this.$4.debugTrace("connect_end")},n.subscribeToLiveEvent=function(t,n,o){var e=this.$10;if(e!=null){var a=new(r("PolarisLiveDeltaHandler"))(n);e.enableLiveEventHandler(t,a,o),e.subscribe()}},n.unsubscribeToLiveEvent=function(t){var e=this.$10;e!=null&&(e.disableLiveEventHandler(t),e.subscribe())},n.getLogger=function(){return this.$4},t})();l.DirectMQTT=s}),98);
__d("ShareSheetImpressionFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(t,n,r,o,a,i,l){"use strict";var e=r("getFalcoLogPolicy_DO_NOT_USE")("5749"),s=o("FalcoLoggerInternal").create("share_sheet_impression",e),u=s;l.default=u}),98);